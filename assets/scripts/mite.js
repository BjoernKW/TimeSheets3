(function(e){"use strict";var r={protocol:"https",domain:"mite.yo.lk",async:true,timeout:60,error:function e(r,t){alert("Error: mite.gyver could not connect with your mite.account!")}},t=function e(){},n=function e(r){return/^\s*$/.test(r)?{}:JSON.parse(r)},i=function e(r){if(!r||typeof r=="String"){return r||""}var t=[];for(var n in r){if(n=="_queryString"){t.push(r[n])}else{t.push([encodeURIComponent(n),encodeURIComponent(r[n])].join("="))}}return t.join("&")},u=function e(r){if(typeof r=="function"){r={success:r}}return r||{}},o=function e(r){for(var t=1,n=arguments.length;t<n;t++){for(var i in arguments[t]){r[i]=arguments[t][i]}}return r};e.Mite=function(e){if(!e||!e.account||!e.api_key){throw"account & api_key need to be set"}var s=o({},r,e),c={},a={},f=function e(r){return s.protocol+"://"+"corsapi."+s.domain+"/"+r+".json"},l=function e(r,i,u){var o=new XMLHttpRequest,f=u.data||null,l=typeof u.async=="boolean"?u.async:s.async,p=u.timeout||s.timeout,d,_;var m=function e(r){var i=r.success||t,u=r.error||s.error,c=r.complete||t,a={success:null,error:null,complete:null};if(/2\d\d/.test(o.status)){if(o.responseText){a.success=[n(o.responseText)];i(a.success[0])}else{a.error=[o,"error"];u(o,"error")}}else{a.error=[o,o.responseText||"error"];u(o,o.responseText||"error")}a.complete=o;c(o);return a};o.onreadystatechange=function(){var e=null;if(o.readyState==4){if(r=="GET"){for(var t=0;t<c[i].length;t++){a[i]=m(c[i][t])}delete c[i]}else{m(u)}clearTimeout(d)}};if(u.error){d=setTimeout(function(){error(o,"timeout")},p*1e3)}o.open(r,i,l);if(f instanceof Object){f=JSON.stringify(f);o.setRequestHeader("Content-Type","application/json")}o.setRequestHeader("X-Requested-With","XMLHttpRequest");o.setRequestHeader("X-MiteApiKey",s.api_key);o.setRequestHeader("X-MiteAccount",s.account);o.send(f);if(!s.async){return n(o.responseText)}},p=function e(r,t,n){var i=u(n);i.data=t;return l("POST",f(r),i)},d=function e(r,t,n){var i=u(n);i.data=t;return l("PUT",f(r),i)},_=function e(r,t){return l("DELETE",f(r),u(t))},m=function e(r){var t=function e(t,n,o){var s,p=/\?/.test(t)?"&":"?";if(typeof o=="undefined"){s=u(n)}else{s=u(o);s.data=n}t=f(t);if(s.data){t+=p+i(s.data);delete s.data}if(!c[t]){if(r&&a[t]){if(s.success&&a[t].success)s.success.apply(null,a[t].success);if(s.error&&a[t].error)s.error.apply(null,a[t].error);if(s.complete&&a[t].complete)s.complete.apply(null,a[t].complete)}else{c[t]=[s];return l("GET",t,s)}}else{c[t].push(s)}},n={_name:function e(){return this._url.replace(/s$/,"").replace(/ie$/,"y")},_wrapParams:function e(r){var t={};t[this._name()]=r;return t},all:function e(r,n){return t(this._url,r,n)},find:function e(r,n){return t(this._url+"/"+r,n)},create:function e(r,t){return p(this._url,this._wrapParams(r),t)},update:function e(r,t,n){return d(this._url+"/"+r,this._wrapParams(t),n)},destroy:function e(r,t){return _(this._url+"/"+r,t)}},m=o({all:undefined,active:n.all,archived:function e(r,n){return t(this._url+"/archived",r,n)}},n),y={create:undefined,update:undefined,destroy:undefined};return{account:function e(r){return t("account",r)},myself:function e(r){return t("myself",r)},TimeEntry:o({_url:"time_entries"},n),Tracker:{find:function e(r){return t("tracker",r)},start:function e(r,t){return d("tracker/"+r,{},t)},stop:function e(r,t){return _("tracker/"+r,t)}},Bookmark:o({_url:"time_entries/bookmarks",time_entries_for:function e(r,n){return t(this._url+"/"+r+"/follow",n)}},n,y),Customer:o({_url:"customers",projects_for:function e(r,n){return t("projects?customer_id="+r,n)},time_entries_for:function e(r,n){return t("time_entries?customer_id="+r,n)}},m),Project:o({_url:"projects",time_entries_for:function e(r,n){return t("time_entries?project_id="+r,n)}},m),Service:o({_url:"services",time_entries_for:function e(r,n){return t("time_entries?service_id="+r,n)}},m),User:o({_url:"users",time_entries_for:function e(r,n){return t("time_entries?user_id="+r,n)}},m,y),config:s,clearCache:function e(r){if(!this._url){return}if(r){a[r]=undefined}else{a={}}}}};return o(m(),{cache:m(true)})}})(window);