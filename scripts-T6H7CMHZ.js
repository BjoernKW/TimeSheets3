(function(k){"use strict";var O={protocol:"https",domain:"mite.de",async:!0,timeout:60,error:function(i,t){alert("Error: "+T(t).error)}};k.Mite=function(t){if(!t||!t.account||!t.api_key)throw"account & api_key need to be set";t=f({},O,t);var a={},l={},y=function(s){return t.protocol+"://corsapi."+t.domain+"/"+s+".json"},v=function(s,n,o){var u=new XMLHttpRequest,_=o.start||t.start||p,e=o.data||null,r=typeof o.async=="boolean"?o.async:t.async,d=o.timeout||t.timeout,c,S;if(u.onreadystatechange=function(){var M=null;if(u.readyState==4){if(s=="GET"){for(var R=0;R<a[n].length;R++)l[n]=j(u,a[n][R]);delete a[n]}else j(u,o);clearTimeout(c)}},o.error&&(c=setTimeout(function(){error(u,"timeout")},d*1e3)),_(u),u.open(s,n,r),e instanceof Object&&(e=JSON.stringify(e),u.setRequestHeader("Content-Type","application/json")),u.setRequestHeader("X-Requested-With","XMLHttpRequest"),u.setRequestHeader("X-MiteApiKey",t.api_key),u.setRequestHeader("X-MiteAccount",t.account),u.send(e),!t.async)return T(u.responseText)},j=function(s,n){var o=n.success||t.success||p,u=n.error||t.error||p,_=n.complete||t.complete||p,e={};return/2\d\d/.test(s.status)?s.responseText?(e.success=[T(s.responseText)],o(e.success[0])):(e.error=[s,"error"],u(s,"error")):(e.error=[s,s.responseText||"error"],u(s,s.responseText||"error")),e.complete=s,_(s),e},H=function(s,n,o){var u=m(o);return u.data=n,v("POST",y(s),u)},q=function(s,n,o){var u=m(o);return u.data=n,v("PUT",y(s),u)},w=function(s,n){return v("DELETE",y(s),m(n))},E=function(s){var n=function(e,r,d){var c,S=/\?/.test(e)?"&":"?";if(typeof d>"u"?c=m(r):(c=m(d),c.data=r),e=y(e),c.data&&(e+=S+b(c.data),delete c.data),a[e])a[e].push(c);else if(s&&l[e])c.success&&l[e].success&&c.success.apply(null,l[e].success),c.error&&l[e].error&&c.error.apply(null,l[e].error),c.complete&&l[e].complete&&c.complete.apply(null,l[e].complete);else return a[e]=[c],v("GET",e,c)},o={_name:function(){return this._url.replace(/s$/,"").replace(/ie$/,"y")},_wrapParams:function(e){var r={};return r[this._name()]=e,r},all:function(e,r){return n(this._url,e,r)},find:function(e,r){return n(this._url+"/"+e,r)},create:function(e,r){return H(this._url,this._wrapParams(e),r)},update:function(e,r,d){return q(this._url+"/"+e,this._wrapParams(r),d)},destroy:function(e,r){return w(this._url+"/"+e,r)}},u=f({all:void 0,active:o.all,archived:function(e,r){return n(this._url+"/archived",e,r)}},o),_={create:void 0,update:void 0,destroy:void 0};return{account:function(e){return n("account",e)},myself:function(e){return n("myself",e)},TimeEntry:f({_url:"time_entries"},o),Tracker:{find:function(e){return n("tracker",e)},start:function(e,r){return q("tracker/"+e,{},r)},stop:function(e,r){return w("tracker/"+e,r)}},Bookmark:f({_url:"time_entries/bookmarks",time_entries_for:function(e,r){return n(this._url+"/"+e+"/follow",r)}},o,_),Customer:f({_url:"customers",projects_for:function(e,r){return n("projects?customer_id="+e,r)},time_entries_for:function(e,r){return n("time_entries?customer_id="+e,r)}},u),Project:f({_url:"projects",time_entries_for:function(e,r){return n("time_entries?project_id="+e,r)}},u),Service:f({_url:"services",time_entries_for:function(e,r){return n("time_entries?service_id="+e,r)}},u),User:f({_url:"users",time_entries_for:function(e,r){return n("time_entries?user_id="+e,r)}},u,_),config:t,clearCache:function(e){this._url&&(e?l[e]=void 0:l={})}}};return f(E(),{cache:E(!0)})};function p(){}function T(i){var t;try{t=JSON.parse(i)}catch{}return t||{}}function b(i){if(!i||typeof i=="string")return i||"";var t=[];for(var a in i)a=="_queryString"?t.push(i[a]):t.push([encodeURIComponent(a),encodeURIComponent(i[a])].join("="));return t.join("&")}function m(i){return typeof i=="function"&&(i={success:i}),i||{}}function f(i){for(var t=1,a=arguments.length;t<a;t++)for(var l in arguments[t])i[l]=arguments[t][l];return i}})(window);
